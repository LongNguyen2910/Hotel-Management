@model IEnumerable<Hotel_Management.Models.Khachhangdatphong>

@{
    ViewData["Title"] = "Index";
    var currentFilter = ViewData["CurrentFilter"] as string ?? string.Empty;
}

<div class="col-12">
    <div class="card overflow-hidden">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Danh sách phòng</h5>
            <div class="d-flex align-items-center">
                <form asp-action="Index" method="get" class="d-flex me-3">
                    <input name="searchString" value="@currentFilter" class="form-control form-control-sm me-2" placeholder="Tìm theo mã khách hàng" />
                    <button type="submit" class="btn btn-sm btn-outline-primary">Tìm</button>
                    @if (!string.IsNullOrWhiteSpace(currentFilter))
                    {
                        <a asp-action="Index" class="btn btn-sm btn-outline-danger btn-link ms-2">Xóa</a>
                    }
                </form>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-sm">
                <thead>
                    <tr>
                        <th class="text-truncate">Mã khách hàng</th>
                        <th class="text-truncate">Mã Phòng</th>
                        <th class="text-truncate">Ngày Đặt</th>
                        <th class="text-truncate">Ngày Check-in</th>
                        <th class="text-truncate">Ngày Check-out</th>
                        <th class="text-truncate">Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                    @if (ViewData["NoResults"] != null)
                    {
                        <tr>
                            <td colspan="7" class="text-center text-muted py-4">
                                <i class="bi bi-exclamation-circle">Không tìm thấy phòng phù hợp</i>
                            </td>
                        </tr>
                    }
                    else
     @foreach (var item in Model)
                        {
                            <tr>
                                <td><h6 class="mb-0 text-truncate">@item.Makhachhang</h6></td>
                                <td><h6 class="mb-0 text-truncate">@item.Maphong</h6></td>
                                <td><h6 class="mb-0 text-truncate">@item.Ngaydat</h6></td>
                                <td><h6 class="mb-0 text-truncate">@item.Ngaycheckin</h6></td>
                                <td><h6 class="mb-0 text-truncate">@item.Ngaycheckout</h6></td>
                                <td>
                                    <!-- Trigger modal instead of navigating -->
                                    <button type="button"
                                            class="btn btn-sm btn-outline-danger"
                                            data-bs-toggle="modal"
                                            data-bs-target="#confirmDeleteModal"
                                            data-id="@item.Maphong"
                                            data-name="@item.Makhachhang">
                                        Xóa
                                    </button>
                                    <a asp-controller="Khachhangdatphongs" asp-action="Details" asp-route-id="@item.Maphong" class="btn btn-sm btn-outline-danger">Chi tiết</a>
                                </td>
                            </tr>
                        }
                </tbody>
            </table>
        </div>
    </div>
</div>
<!-- Delete confirm card (Bootstrap modal) -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content shadow">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmDeleteLabel">Xác nhận xóa</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning mb-0">
                    Bạn có chắc chắn muốn xóa đơn đặt phòng <strong id="delete-item-id"></strong> do khách hàng
                    <strong id="delete-item-name"></strong> đặt không?
                </div>
            </div>
            <div class="modal-footer">
                <form id="deleteForm" method="post" asp-controller="Khachhangdatphongs" asp-action="Delete" class="m-0">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="id" id="delete-id" />
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-danger">Xóa</button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Populate modal with item info, wire id into the POST form
        const confirmModal = document.getElementById('confirmDeleteModal');
        if (confirmModal) {
            confirmModal.addEventListener('show.bs.modal', (event) => {
                const button = event.relatedTarget;
                if (!button) return;

                const id = button.getAttribute('data-id');
                const name = button.getAttribute('data-name') || data-id;

                document.getElementById('delete-id').value = id;
                document.getElementById('delete-item-id').textContent = id;
                document.getElementById('delete-item-name').textContent = name;
            });
        }
    </script>
}