@model Hotel_Management.Helpers.PaginatedList<Hotel_Management.Models.Thucdon>

@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_ContentNavbarLayout.cshtml";
}

<div class="col-12">
    <div class="card overflow-hidden">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Danh sách thực đơn</h5>
            <div class="d-flex align-items-center">
                @if (User.IsInRole("Admin") || User.IsInRole("Quản lý nhà hàng") || User.IsInRole("Quản lý khách sạn"))
                {
                    <a asp-controller="Thucdons" asp-action="Create" class="btn btn-sm btn-primary">Thêm thực đơn</a>
                }
            </div>
        </div>
        <div id="thucdonTableContainer">
            @await Html.PartialAsync("ThucdonTable", Model)
        </div>
    </div>
</div>
@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {

            const tableContainer = document.getElementById('thucdonTableContainer');

            // Hàm tải nội dung AJAX
            function loadTable(url) {
                // Hiển thị loading (nếu muốn)
                // tableContainer.innerHTML = 'Đang tải...';

                fetch(url, {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest' // Đây là chìa khóa để Controller nhận diện AJAX
                    }
                })
                .then(response => response.text())
                .then(html => {
                    tableContainer.innerHTML = html;
                })
                .catch(error => {
                    console.error('Lỗi khi tải dữ liệu:', error);
                    // Xử lý lỗi (ví dụ: hiển thị thông báo)
                });
            }

            // 2. Bắt sự kiện click cho Phân trang, Xóa filter, và Click vào hàng
            // Chúng ta dùng "event delegation" vì các nút này được tải lại liên tục
            tableContainer.addEventListener('click', function(e) {

                // Tìm xem có click vào nút phân trang/xóa filter không
                const ajaxLink = e.target.closest('a.ajax-link');
                if (ajaxLink && !ajaxLink.classList.contains('disabled')) {
                    e.preventDefault(); // Ngăn link tải lại trang
                    loadTable(ajaxLink.href);
                    return; // Dừng lại
                }

                // Tìm xem có click vào nút Sửa/Xóa không
                const actionLink = e.target.closest('a.ajax-action');
                if (actionLink) {
                    // Đây là nút Sửa/Xóa, không làm gì cả, để link hoạt động bình thường
                    return;
                }
            });

        });
    </script>
}